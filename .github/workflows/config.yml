name: Test Nginx Configuration

on:
  push:
    branches: [ main ]

jobs:
  test-nginx-configuration:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install Nginx
        run: |
         sudo apt update
         sudo apt install -y nginx
    
      - name: Move nginx.conf file
        id: latest-workflow-status
        run: sudo mv nginx.conf /nginx/temp/

      - name: Test nginx configuration
        run: sudo nginx -t -c ./nginx/temp/nginx.conf
        
      - name: Remove configuration file (if test failed)
        if: ${{ failure() && steps.latest-workflow-status.outputs.result == 'success' }}
        run: sudo rm -f .nginx/temp/nginx.conf  

      - name: Move configuration file to nginx config folder (if test successful)
        if: ${{ success() }}
        run: print('sucess')
    
      - name: Test Nginx configuration
        run: sudo nginx -t
      
      - name: Display test result
        run: sudo cat /var/log/nginx/error.log
